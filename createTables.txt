DROP TABLE IF EXISTS vi_producto_fruta;

DROP TABLE IF EXISTS vi_producto_subcategoria;

DROP TABLE IF EXISTS vi_inventarioalmacen;

DROP TABLE IF EXISTS vi_contenidoeducativo;

DROP TABLE IF EXISTS vi_fruta;

DROP TABLE IF EXISTS vi_subcategoria;

DROP TABLE IF EXISTS vi_tipoproducto;

DROP TABLE IF EXISTS vi_producto;

DROP TABLE IF EXISTS vi_almacen;

DROP TABLE IF EXISTS vi_igv;

DROP TABLE IF EXISTS vi_ordenserie;

DROP TABLE IF EXISTS vi_metodopago;

DROP TABLE IF EXISTS vi_banco;

DROP TABLE IF EXISTS vi_pedido;

DROP TABLE IF EXISTS vi_detallepedido;

DROP TABLE IF EXISTS vi_venta;

DROP TABLE IF EXISTS vi_pedido_metodopago;

DROP TABLE IF EXISTS vi_pago;

-- Libro de Reclamaciones

CREATE TABLE vi_libroreclamaciones (
    id VARCHAR(50) PRIMARY KEY,
    fechaincidente TIMESTAMP NOT NULL,
    nombres VARCHAR(100) NOT NULL,
    apellidos VARCHAR(100) NOT NULL,
    correo VARCHAR(100) NOT NULL,
    telefono VARCHAR(20),
    tipodoc VARCHAR(3) NOT NULL,
    nrdocumento VARCHAR(20) NOT NULL,
    menor BOOLEAN DEFAULT FALSE NOT NULL,
    departamento VARCHAR(50) NOT NULL,
    provincia VARCHAR(50) NOT NULL,
    distrito VARCHAR(50) NOT NULL,
    direccion VARCHAR(200) NOT NULL,
    tipo VARCHAR(10) NOT NULL,
    montoreclamado DECIMAL(10, 2) NOT NULL,
    descripcion TEXT NOT NULL,
    reclamacion VARCHAR(7) NOT NULL,
    nrpedido VARCHAR(50),
    fechapedido TIMESTAMP,
    detalle TEXT,
    pedidoconcreto TEXT,
    urlcomprobante VARCHAR(200),
    accionesproveedor TEXT,
	--TO DO id_usuario VARCHAR(50),
	--TO DO CONSTRAINT fk_usuario FOREIGN KEY (id_usuario) REFERENCES vi_usuario(id),
	--trazabilidad
    estaactivo BOOLEAN DEFAULT TRUE NOT NULL,
    desactivadoen TIMESTAMP,
    creadoen TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    actualizadoen TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    usuariocreacion VARCHAR(50) NOT NULL,
    usuarioactualizacion VARCHAR(50)	
);

-- Gestión de productos

CREATE TABLE vi_tipoproducto (
    id VARCHAR(50) PRIMARY KEY,
	nombre varchar(255) not null,
	--trazabilidad
    estaactivo boolean default true not null,
    eliminadoen timestamp null,
    creadoen timestamp default current_timestamp not null,
    actualizadoen timestamp default current_timestamp not null,
    usuariocreacion varchar(50) not null,
    usuarioactualizacion varchar(50)
);

create table vi_producto (
    id varchar(50) primary key,
    codigo varchar(255) unique not null,
    nombre varchar(255) not null,
    "precioA" decimal(10, 2) not null,
    "precioB" decimal(10, 2) not null,
    "precioC" decimal(10, 2) not null,
    "urlImagen" varchar(255) not null,
    "cantMinPed" int not null,
    "cantMaxPed" int not null,
    descripcion text,
    "informacionNutricional" text,
    "razonEliminacion" text,
    estado boolean default true not null,
    usuariocreacion varchar(255) not null,
    usuarioactualizacion varchar(255),
    "sevendeEcommerce" boolean default false not null,
    creadoen timestamp default current_timestamp not null,
    actualizadoen timestamp default current_timestamp not null,
    desactivadoen timestamp null,
	id_tipoproducto VARCHAR(50),
	CONSTRAINT fk_tipo_producto FOREIGN KEY (id_tipoproducto) REFERENCES vi_tipoproducto(id)
);

create table vi_fruta (
    idfruta varchar(50) primary key,
    nombre varchar(255) not null,
    urlimagen varchar(255) not null,
    descripcion text,
    informacioneducativa text,
	--trazabilidad
    estaactivo boolean default true not null,
    eliminadoen timestamp null,
    creadoen timestamp default current_timestamp not null,
    actualizadoen timestamp default current_timestamp not null,
    usuariocreacion varchar(50) not null,
    usuarioactualizacion varchar(50)
);

CREATE TABLE vi_subcategoria (
    id VARCHAR(50) PRIMARY KEY,
	nombre varchar(255) not null,
	--trazabilidad
    estaactivo boolean default true not null,
    eliminadoen timestamp null,
    creadoen timestamp default current_timestamp not null,
    actualizadoen timestamp default current_timestamp not null,
    usuariocreacion varchar(50) not null,
    usuarioactualizacion varchar(50)
);


CREATE TABLE vi_contenidoeducativo (
    id VARCHAR(50) PRIMARY KEY,
    id_fruta VARCHAR(50),
	titulo varchar(200) not null,
    descripcion TEXT NULL,
    tipocontenido VARCHAR(100) NOT NULL,
    urlcontenido VARCHAR(255) NOT NULL,
	fechapublicacion TIMESTAMP NOT NULL,
    --trazabilidad
    estaactivo boolean default true not null,
    eliminadoen timestamp null,
    creadoen timestamp default current_timestamp not null,
    actualizadoen timestamp default current_timestamp not null,
    usuariocreacion varchar(50) not null,
    usuarioactualizacion varchar(50),
	CONSTRAINT fk_fruta FOREIGN KEY (id_fruta) REFERENCES vi_fruta(id)
);

CREATE TABLE vi_almacen (
    idAlmacen VARCHAR(50) PRIMARY KEY,
	nombre varchar(255) not null,
    --trazabilidad
    estaactivo boolean default true not null,
    eliminadoen timestamp null,
    creadoen timestamp default current_timestamp not null,
    actualizadoen timestamp default current_timestamp not null,
    usuariocreacion varchar(50) not null,
    usuarioactualizacion varchar(50)
);

CREATE TABLE vi_inventarioalmacen (
    id VARCHAR(50) PRIMARY KEY,
    stock INT,
    estaactivo BOOLEAN DEFAULT TRUE,
    eliminadoen TIMESTAMP NULL,
    creadoen TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    actualizadoen TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    usuariocreacion VARCHAR(50),
    usuarioactualizacion VARCHAR(50),
    id_producto VARCHAR(50),
    id_almacen VARCHAR(50),
    CONSTRAINT fk_producto FOREIGN KEY (id_producto) REFERENCES vi_producto(id),
    CONSTRAINT fk_almacen FOREIGN KEY (id_almacen) REFERENCES vi_almacen(idAlmacen)
);

CREATE TABLE vi_producto_subcategoria (
    producto_id VARCHAR(50),
    subcategoria_id VARCHAR(50),
    PRIMARY KEY (producto_id, subcategoria_id),
    CONSTRAINT fk_producto FOREIGN KEY (producto_id) REFERENCES vi_producto(id),
    CONSTRAINT fk_subcategoria FOREIGN KEY (subcategoria_id) REFERENCES vi_subcategoria(id),
	--trazabilidad
    estaactivo boolean default true not null,
    eliminadoen timestamp null,
    creadoen timestamp default current_timestamp not null,
    actualizadoen timestamp default current_timestamp not null,
    usuariocreacion varchar(50) not null,
    usuarioactualizacion varchar(50)
);


CREATE TABLE vi_producto_fruta (
    producto_id VARCHAR(50),
    fruta_id VARCHAR(50),
    PRIMARY KEY (producto_id, fruta_id),
    CONSTRAINT fk_producto FOREIGN KEY (producto_id) REFERENCES vi_producto(id),
    CONSTRAINT fk_fruta FOREIGN KEY (fruta_id) REFERENCES vi_fruta(id)
	--trazabilidad
    estaactivo boolean default true not null,
    eliminadoen timestamp null,
    creadoen timestamp default current_timestamp not null,
    actualizadoen timestamp default current_timestamp not null,
    usuariocreacion varchar(50) not null,
    usuarioactualizacion varchar(50)
);
-- Gestión de envios

CREATE TABLE vi_igv (
    id VARCHAR(50) PRIMARY KEY,
    porcentaje DECIMAL(5, 2) NOT NULL,
    --trazabilidad
    estaactivo BOOLEAN DEFAULT TRUE NOT NULL,
    desactivadoen TIMESTAMP,
    creadoen TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    actualizadoen TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    usuariocreacion VARCHAR(50) NOT NULL,
    usuarioactualizacion VARCHAR(50)
);

CREATE TABLE vi_ordenserie (
    id VARCHAR(50) PRIMARY KEY,
    nombre VARCHAR(10) NOT NULL,
    descripcion TEXT,
    --trazabilidad
    estaactivo BOOLEAN DEFAULT TRUE NOT NULL,
    desactivadoen TIMESTAMP,
    creadoen TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    actualizadoen TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    usuariocreacion VARCHAR(50) NOT NULL,
    usuarioactualizacion VARCHAR(50)
);

CREATE TABLE vi_metodopago (
    id VARCHAR(50) PRIMARY KEY,
    nombre VARCHAR(50) NOT NULL,
    --trazabilidad
    estaactivo BOOLEAN DEFAULT TRUE NOT NULL,
    desactivadoen TIMESTAMP,
    creadoen TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    actualizadoen TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    usuariocreacion VARCHAR(50) NOT NULL,
    usuarioactualizacion VARCHAR(50)
);


CREATE TABLE vi_banco (
    id VARCHAR(50) PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    --trazabilidad
    estaactivo BOOLEAN DEFAULT TRUE NOT NULL,
    desactivadoen TIMESTAMP,
    creadoen TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    actualizadoen TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    usuariocreacion VARCHAR(50) NOT NULL,
    usuarioactualizacion VARCHAR(50)
);

CREATE TABLE vi_pedido (
    id VARCHAR(50) PRIMARY KEY,
    estado VARCHAR(50) NOT NULL,
    prioridadentrega VARCHAR(20),
    total DECIMAL(10, 2) NOT NULL,
	puntosotorgados INT DEFAULT 0,
    motivocancelacion TEXT,
    codigoseguimiento VARCHAR(100),
    montoefectivopagar DECIMAL(10, 2),
	--TO DO id_motorizado VARCHAR(50),
	--TO DO CONSTRAINT fk_motorizado FOREIGN KEY (id_motorizado) REFERENCES vi_motorizado(id),
	--TO DO id_direccion VARCHAR(50),
	--TO DO CONSTRAINT fk_direccion FOREIGN KEY (id_direccion) REFERENCES vi_direccion(id),
	--TO DO id_usuario VARCHAR(50),
	--TO DO CONSTRAINT fk_usuario FOREIGN KEY (id_usuario) REFERENCES vi_usuario(id),
	--trazabilidad
    estaactivo BOOLEAN DEFAULT TRUE NOT NULL,
    desactivadoen TIMESTAMP,
    creadoen TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    actualizadoen TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    usuariocreacion VARCHAR(50) NOT NULL,
    usuarioactualizacion VARCHAR(50)
);

-- TO DO TABLE vi_pedido_notificacion

CREATE TABLE vi_detallepedido (
    id_producto VARCHAR(50),
	id_pedido VARCHAR(50),
	PRIMARY KEY (producto_id, fruta_id),
	CONSTRAINT fk_producto FOREIGN KEY (id_producto) REFERENCES vi_producto(id),
	CONSTRAINT fk_pedido FOREIGN KEY (id_pedido) REFERENCES vi_pedido(id),
	cantidad INT NOT NULL,
    subtotal DECIMAL(10, 2) NOT NULL,
	--TO DO id_promocion VARCHAR(50),
	--TO DO CONSTRAINT fk_promocion FOREIGN KEY (id_promocion) REFERENCES vi_promocion(id),
    --trazabilidad
    estaactivo BOOLEAN DEFAULT TRUE NOT NULL,
    desactivadoen TIMESTAMP,
    creadoen TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    actualizadoen TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    usuariocreacion VARCHAR(50) NOT NULL,
    usuarioactualizacion VARCHAR(50)
);




CREATE TABLE vi_venta (
    id VARCHAR(50) PRIMARY KEY,
    tipocomprobante VARCHAR(10) NOT NULL,
    fechaventa TIMESTAMP NOT NULL,
    numerocomprobante VARCHAR(50) NOT NULL,
    montototal DECIMAL(10, 2) NOT NULL,
    totalpaletas INT NOT NULL,
    totalmafeletas INT NOT NULL,
    estado VARCHAR(50) NOT NULL,
    totaligv DECIMAL(10, 2) NOT NULL,
	id_pedido VARCHAR(50),
	CONSTRAINT fk_pedido FOREIGN KEY (id_pedido) REFERENCES vi_pedido(id),
	id_ordenserie VARCHAR(50),
	CONSTRAINT fk_ordenserie FOREIGN KEY (id_ordenserie) REFERENCES vi_ordenserie(id),
    --trazabilidad
    estaactivo BOOLEAN DEFAULT TRUE NOT NULL,
    desactivadoen TIMESTAMP,
    creadoen TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    actualizadoen TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    usuariocreacion VARCHAR(50) NOT NULL,
    usuarioactualizacion VARCHAR(50)
);




CREATE TABLE vi_pedido_metodopago (
	id_pedido VARCHAR(50),
	id_metodopago VARCHAR(50),
	PRIMARY KEY(id_pedido, id_metodopago),
	CONSTRAINT fk_pedido FOREIGN KEY (id_pedido) REFERENCES vi_pedido(id),
	CONSTRAINT fk_metodopago FOREIGN KEY (id_metodopago) REFERENCES vi_metodopago(id),
	--trazabilidad
    estaactivo BOOLEAN DEFAULT TRUE NOT NULL,
    desactivadoen TIMESTAMP,
    creadoen TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    actualizadoen TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    usuariocreacion VARCHAR(50) NOT NULL,
    usuarioactualizacion VARCHAR(50)
);

CREATE TABLE vi_pago (
    id VARCHAR(50) PRIMARY KEY,
    estransferencia BOOLEAN NOT NULL,
    montocobrado DECIMAL(10, 2) NOT NULL,
    numerooperacion VARCHAR(50),
    urlevidencia VARCHAR(200),
	codigotransaccion VARCHAR(100),
	id_venta VARCHAR(50),
	CONSTRAINT fk_venta FOREIGN KEY (id_venta) REFERENCES vi_venta(id),
	id_metodopago VARCHAR(50),
	CONSTRAINT fk_metodopago FOREIGN KEY (id_metodopago) REFERENCES vi_metodopago(id),
	id_banco VARCHAR(50),
	CONSTRAINT fk_banco FOREIGN KEY (id_banco) REFERENCES vi_banco(id),
    --trazabilidad
    estaactivo BOOLEAN DEFAULT TRUE NOT NULL,
    desactivadoen TIMESTAMP,
    creadoen TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    actualizadoen TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    usuariocreacion VARCHAR(50) NOT NULL,
    usuarioactualizacion VARCHAR(50)
);



